<link rel="import" href="../core-menu/core-menu.html">
<link rel="import" href="../core-collapse/core-collapse.html">
<link rel="import" href="../polymer/polymer.html">
<polymer-element name="cg-dropdown" attributes="valueattr">
    <template>
        <div id="selected"></div>
        <core-collapse id="collapse">
            <core-menu id="menu" on-core-select="{{_change}}">
                <content id="content" select="*"></content>
            </core-menu>
        </core-collapse>
    </template>
    <script>
        Polymer('cg-dropdown', {
            publish: {
                valueattr: "name"
            },

            /**
             * Select the element.
             * @param element
             * @method
             * @private
             */
            _select: function (element) {
                this.$.selected.innerHTML = element.getAttribute(this.valueattr);
            },

            /**
             * Toggle the dropdown visibility.
             * @method
             * @private
             */
            _toggleDropdown: function () {
                this.$.collapse.toggle();
            },

            /**
             *
             * @param e {Event}
             * @param element {Object}
             * @delegate
             * @private
             */
            _change: function (e, element) {
                this._select(element.item);
                this.$.collapse.opened = false;
            },

            /**
             * @delegate
             */
            ready: function () {
                this._select(this.$.content.getDistributedNodes()[1]);
                this.$.selected.addEventListener('click', this._toggleDropdown.bind(this));
            }
        });
    </script>
</polymer-element>