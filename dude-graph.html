<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../paper-toast/paper-toast.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<!--
`dude-graph` is a Polymer element which creates a codegraph svg renderer which can be manipulated using several methods and properties.

@group dude-graph
@element dude-graph
@demo demo/index.html
-->
<dom-module id="dude-graph">
    <style>
        #svg {
            background: var(--cg-background-color);
        }
    </style>
    <template>
        <div class="layout flex horizontal">
            <svg id="svg" class="flex"></svg>
        </div>
    </template>
</dom-module>
<script src="../d3/d3.js"></script>
<script src="../lodash/lodash.js"></script>
<script src="dude-graph.js"></script>
<script>
    var CgElement = Polymer({

        is: "dude-graph",

        properties: {

            /**
             * This JSON represents the graph data for a given codegraph.
             */
            graphData: {
                "type": Object
            },

            /**
             * This JSON represents the graphical blocks to render.
             */
            rendererData: {
                "type": Object
            },

            /**
             * A list of blocks models used as shortcuts to generate blocks.
             */
            modelsData: {
                "type": Object
            },

            /**
             * Holds a reference on the graph.
             */
            graph: {
                "type": dudeGraph.Graph
            },

            /**
             * Holds a reference on the renderer.
             */
            renderer: {
                "type": dudeGraph.Renderer
            }
        },
        ready: function () {
            this.graph = new dudeGraph.Graph(this.graphData, this.modelsData);
            this.renderer = new dudeGraph.Renderer(this.$.svg, this.graph, this.rendererData);
            this.renderer.addBlockType(dudeGraph.Block);
            this.renderer.addBlockType(dudeGraph.Function);
            this.renderer.addBlockType(dudeGraph.Instruction);
            this.renderer.addBlockType(dudeGraph.Delegate);
            this.renderer.addBlockType(dudeGraph.Assignation);
            this.renderer.addBlockType(dudeGraph.Variable);
            this.renderer.addBlockType(dudeGraph.Value);
            this.renderer.addBlockType(dudeGraph.Each);
            this.renderer.addBlockType(dudeGraph.Range);
            this.renderer.addBlockType(dudeGraph.Condition);
            this.renderer.addBlockType(dudeGraph.Getter);
            this.renderer.addBlockType(dudeGraph.Operator);
            this.graph.loader.load();
            this.renderer.initialize();
            this.renderer.on("error", function (error) {
                this.fire("error", {error: error, message: error.message});
            }.bind(this));
        }
    });
</script>