<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../iron-localstorage/iron-localstorage.html">
<link rel="import" href="../dude-graph-editor.html">
<link rel="import" href="../dude-graph-inspector.html">
<script src="demo-shoot-behavior.js"></script>
<!--
`demo-wrapper` is a Polymer element to wrap dude-graph demos
-->
<dom-module id="demo-wrapper">
    <style>
        #wrapper {
            border: 2px solid #222222;
        }
        .panel {
            border: 2px solid #222222;
        }
    </style>
    <template>
        <iron-localstorage
                name="dude-wrapper-graph-data"
                value="{{ graphData }}"
                on-iron-localstorage-load-empty="_graphRendererDataEmpty">
        </iron-localstorage>
        <iron-localstorage
                name="dude-wrapper-renderer-data"
                value="{{ rendererData }}"
                on-iron-localstorage-load-empty="_graphRendererDataEmpty">
        </iron-localstorage>
        <div id="wrapper" class="layout horizontal fit">
            <dude-graph-editor id="dudeGraphEditor"
                               class="panel layout horizontal flex-2"
                               graph-data="[[ graphData ]]"
                               renderer-data="[[ rendererData ]]"
                               renderer-config="[[ rendererConfig ]]"
                               on-dude-graph-editor-error="_handleDudeGraphEditorError">
            </dude-graph-editor>
            <dude-graph-inspector id="dudeGraphInspector"
                                  class="panel layout horizontal flex"
                                  model-data="[[ modelData ]]"
                                  on-dude-graph-inspector-save="_dudeGraphInspectorSave">
            </dude-graph-inspector>
        </div>
    </template>
    <script>
        Polymer({
            is: "demo-wrapper",
            properties: {
                /**
                 * The graph data
                 */
                "graphData": {
                    "type": Object,
                    "value": DEMO_SHOOT_BEHAVIOR_GRAPH_DATA
                },

                "rendererConfig": {
                    "type": Object,
                    "value": {
                        "zoom": {
                            "translate": [0, 0],
                            "scale": 1,
                            "min": 0.25,
                            "max": 5,
                            "transitionSpeed": 500
                        },
                        "block": {
                            "padding": 10,
                            "header": 40,
                            "size": [80, 100],
                            "borderRadius": 0
                        },
                        "group": {
                            "padding": 10,
                            "header": 30,
                            "size": [200, 150],
                            "borderRadius": 0
                        },
                        "point": {
                            "height": 20,
                            "radius": 3,
                            "offset": 20
                        }
                    }
                },

                /**
                 * The renderer
                 */
                "rendererData": {
                    "type": Object,
                    "value": DEMO_SHOOT_BEHAVIOR_RENDERER_DATA
                },

                /**
                 * The blocks
                 */
                "modelData": {
                    "type": Array,
                    "value": DEMO_SHOOT_BEHAVIOR_MODEL_DATA
                }
            },

            /**
             * Called when the demo-wrapper element is attached
             * LocalStorage data needs to be loaded before this gets called
             * @delegate
             */
            attached: function () {
                this.$.dudeGraphInspector.dudeGraphEditor = this.$.dudeGraphEditor;
                this.$.dudeGraphEditor.load();
                this.$.dudeGraphInspector.load();
            },

            /**
             * Called when the graphData and rendererData are empty in localStorage
             * @delegate
             * @private
             */
            _graphRendererDataEmpty: function () {
                this.set("graphData", DEMO_SHOOT_BEHAVIOR_GRAPH_DATA);
                this.set("rendererData", DEMO_SHOOT_BEHAVIOR_RENDERER_DATA);
            },

            /**
             * Called when a error occurs in dudeGraphEditor
             * @param {CustomEvent} e
             * @private
             */
            _handleDudeGraphEditorError: function (e) {
                console.error(e.detail.error);
            },

            /**
             * Called when the cgRenderer and the cgGraph is saved
             * Updates the localStorage
             * @param {CustomEvent} e
             * @private
             */
            _dudeGraphInspectorSave: function (e) {
                this.set("graphData", e.detail.graphData);
                this.set("rendererData", e.detail.rendererData);
            }
        });
    </script>
</dom-module>