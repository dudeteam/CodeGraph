<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../../../polymer/polymer.html">
<link rel="import" href="../../../iron-localstorage/iron-localstorage.html">
<link rel="import" href="../../../paper-toast/paper-toast.html">
<link rel="import" href="../../dude-graph-editor.html">
<link rel="import" href="../../dude-graph-inspector.html">
<link rel="import" href="../../../dude-toolbar/dude-toolbar.html">
<script src="demo-dude.js"></script>
<!--
`demo-dude` is a Polymer element to wrap a dude-graph demo
-->
<dom-module id="demo-dude">
    <style>
        #wrapper {
            background: var(--dude-primary-background-color);
        }

        dude-graph-inspector {
            border-radius: 5px;
            background: var(--dude-secondary-background-color);
            margin: 10px;
        }

        #error {
            color: var(--text-primary-color);
            background: var(--paper-red-500);
        }
    </style>
    <template>
        <iron-localstorage
                name="dude-wrapper-graph-data"
                value="{{ graphData }}"
                on-iron-localstorage-load-empty="_loadDefaults">
        </iron-localstorage>
        <iron-localstorage
                name="dude-wrapper-renderer-data"
                value="{{ rendererData }}"
                on-iron-localstorage-load-empty="_loadDefaults">
        </iron-localstorage>
        <div id="wrapper" class="layout horizontal fit">
            <div class="layout vertical flex">
                <div class="layout horizontal flex">
                    <paper-toast id="error"></paper-toast>
                    <dude-graph-editor id="editor"
                                       class="layout horizontal flex-3"
                                       models="[[ models ]]"
                                       on-dude-graph-editor-error="_error">
                    </dude-graph-editor>
                </div>
                <dude-toolbar id="toolbar"></dude-toolbar>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: "demo-dude",
            properties: {
                /**
                 * The graph data
                 */
                "graphData": {
                    "type": Object,
                    "value": DEMO_DUDE_GRAPH_DATA
                },

                /**
                 * The renderer config
                 */
                "rendererConfig": {
                    "type": Object,
                    "value": {}
                },

                /**
                 * The renderer data
                 */
                "rendererData": {
                    "type": Object,
                    "value": DEMO_DUDE_RENDERER_DATA
                },

                /**
                 * The model data
                 */
                "models": {
                    "type": Array,
                    "value": DEMO_DUDE_MODEL_DATA
                }
            },

            /**
             * Called when the demo-dude element is attached
             * LocalStorage data needs to be loaded before this gets called
             */
            attached: function () {
                this.$.editor.start();
                this.$.toolbar.addCommand({
                    icon: "fa fa-save",
                    description: "Save graph",
                    shortcut: ["ctrl+s", "meta+s"],
                    action: this._save.bind(this)
                });
                this.$.toolbar.addCommand({
                    icon: "fa fa-play",
                    description: "Build graph",
                    shortcut: ["ctrl+b", "meta+b"],
                    action: this._build.bind(this)
                });
                this.$.toolbar.addCommand({
                    icon: "fa fa-trash",
                    description: "Remove selection",
                    shortcut: ["del", "meta+backspace"],
                    action: this._removeSelection.bind(this)
                });
                this.$.toolbar.addCommand({
                    icon: "fa fa-square-o",
                    description: "Create group",
                    shortcut: ["ctrl+g", "meta+g"],
                    action: this._createGroup.bind(this)
                });
                this.$.toolbar.addCommand({
                    icon: "fa fa-compress",
                    description: "Zoom to fit",
                    shortcut: ["ctrl+0", "meta+0"],
                    action: this._zoomToFit.bind(this)
                });
                this.$.toolbar.addCommand({
                    hidden: true,
                    icon: "fa fa-compress",
                    description: "Zoom to selection",
                    shortcut: ["ctrl+shift+0", "meta+shift+0"],
                    action: function (e) { this.$.inspector.shortcutZoomToFit(e); }.bind(this)
                });
                this.$.toolbar.addCommand({
                    hidden: true,
                    icon: "fa fa-circle",
                    description: "Select blocks",
                    shortcut: ["ctrl+shift+a", "meta+shift+a"],
                    action: function (e) { this.$.inspector.shortcutSelectAll(e); }.bind(this)
                });
                this.$.toolbar.addCommand({
                    hidden: true,
                    icon: "fa fa-circle",
                    description: "Select groups",
                    shortcut: ["ctrl+alt+a", "meta+alt+a"],
                    action: function (e) { this.$.inspector.shortcutSelectAll(e); }.bind(this)
                });
                this.$.toolbar.addCommand({
                    hidden: true,
                    icon: "fa fa-circle",
                    description: "Select all",
                    shortcut: ["ctrl+shift+alt+a", "meta+shift+alt+a"],
                    action: function (e) { this.$.inspector.shortcutSelectAll(e); }.bind(this)
                });
                this.$.editor.load(this.get("graphData"), this.get("rendererData"));
            },

            /**
             * Save command.
             */
            _save: function () {
                var data = this.$.editor.get("renderer").save();
                this.set("graphData", data.graphData);
                this.set("rendererData", data.rendererData);
            },

            /**
             * Build command.
             */
            _build: function () {
                console.log("build...");
            },

            /**
             * RemoveSelection command.
             */
            _removeSelection: function () {
                this.$.editor.get("renderer").removeSelection();
            },

            /**
             * Create group command.
             */
            _createGroup: function () {

            },

            /**
             * Zoom to fit command.
             */
            _zoomToFit: function () {

            },

            /**
             * Called when the graphData and rendererData are empty in localStorage
             * @private
             */
            _loadDefaults: function () {
                this.set("graphData", DEMO_DUDE_GRAPH_DATA);
                this.set("rendererData", DEMO_DUDE_RENDERER_DATA);
            },

            /**
             * Called when a error occurs in the editor
             * @param {CustomEvent} e
             * @private
             */
            _error: function (e) {
                this.$.error.text = e.detail.error;
                this.$.error.show();
            }
        });
    </script>
</dom-module>