<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../dude-hierarchy/dude-hierarchy.html">
<link rel="import" href="../../dude-toolbar/dude-toolbar.html">
<link rel="import" href="../../dude-collapse/dude-collapse.html">
<link rel="import" href="../../dude-property/dude-property.html">
<script src="dude-graph-toolbar.js"></script>
<!--
`dude-graph-edit-block` is a panel used to add a new blocks/variables to the graph.

@group dude-graph
@element dude-graph-edit-block-group
@demo demo/index.html
-->
<dom-module id="dude-graph-create-variable">
    <style>
        .toolbar {
            margin-top: 16px;
            margin-bottom: 16px;
        }
        paper-button {
            @apply(--dude-button);
        }
    </style>
    <template>
        <div class="toolbar">
            <dude-toolbar id="toolbar"></dude-toolbar>
        </div>
        <dude-collapse heading="Create variable">
            <dude-property
                    property-type="String"
                    property-name="Variable name"
                    property-value="{{ variable.variableName }}">
            </dude-property>
            <dude-property
                    property-type="Choice"
                    property-name="Variable value type"
                    property-data="[[ variableTypes ]]"
                    property-value="{{ variable.variableValueType }}">
            </dude-property>
            <dude-property
                    property-type="[[ variable.variableValueType ]]"
                    property-name="Variable value"
                    property-value="{{ variable.variableValue }}">
            </dude-property>
            <paper-button on-click="_createVariable">Create variable</paper-button>
        </dude-collapse>
    </template>
    <script>
        /**
         * @extends {DudeInspectorItemElement}
         */
        Polymer({
            is: "dude-graph-create-variable",
            properties: {
                "inspector": {
                    "type": "DudeInspectorElement",
                    "readonly": true
                },
                "data": {
                    "type": "DudeGraphElement",
                    "readonly": true
                },
                "panelTitle": {
                    "type": String,
                    "value": "Create variable",
                    "readonly": true
                },
                "variable": {
                    "type": Object
                },
                "variableTypes": {
                    "type": Array,
                    "value": ["String", "Number", "Boolean"]
                }
            },

            /**
             * Called when the panel is attached to the DOM
             * Notifies the dude-stack
             */
            attached: function () {
                dudeGraph.ToolbarHelper.clearToolbar(this);
                this.fire("dude-inspector-attached");
            },

            /**
             * Called when the panel is opened
             */
            opened: function () {
                this.set("variable", {
                    "variableName": "",
                    "variableValueType": "String",
                    "variableValue": null
                });
            },

            /**
             * Called when the panel is the top of the stack
             */
            resumed: function () {},

            /**
             * Called when the panel is not anymore the top of the stack
             */
            paused: function () {},

            /**
             * Called when the panel is closed
             */
            closed: function () {},

            /**
             * Creates the variable
             * @private
             */
            _createVariable: function () {
                var variable = this.get("variable");
                if (!_.isString(variable.variableName) || _.isEmpty(variable.variableName)) {
                    throw new Error("Variable name must be a non empty string");
                }
                if (!_.isString(variable.variableValueType) || _.isEmpty(variable.variableValueType)) {
                    throw new Error("Variable value type must be a non empty string");
                }
                try {
                    this.get("data").createVariable(variable);
                    this.get("inspector").clearStack();
                    this.get("inspector").updateDudeGraphElement(true);
                } catch (e) {
                    console.error(e);
                }
            }
        });
    </script>
</dom-module>