<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../dude-hierarchy/dude-hierarchy.html">
<link rel="import" href="../../dude-toolbar/dude-toolbar.html">
<link rel="import" href="../../dude-collapse/dude-collapse.html">
<!--
`dude-graph-create` is a panel used to add a new blocks/variables to the graph.

@group dude-graph
@element dude-graph-create-group
@demo demo/index.html
-->
<dom-module id="dude-graph-create">
    <style>
        .toolbar {
            margin-top: 16px;
            margin-bottom: 16px;
        }
    </style>
    <template>
        <div class="toolbar">
            <dude-toolbar id="toolbar"></dude-toolbar>
        </div>
        <dude-collapse heading="Create block">
            <dude-hierarchy
                    id="modelsHierarchy"
                    placeholder="Search block..."
                    items="{{ data.models }}"
                    on-dude-hierarchy-item-submit="_createBlock">
            </dude-hierarchy>
        </dude-collapse>
    </template>
    <script>
        /**
         * @extends {DudeStackItemElement}
         */
        Polymer({
            is: "dude-graph-create",
            properties: {
                "data": {
                    "type": "DudeGraphElement",
                    "readonly": true
                },
                "panelTitle": {
                    "type": String,
                    "value": "Inspector",
                    "readonly": true
                }
            },

            /**
             * Called when the panel is attached to the DOM
             * Notifies the dude-stack
             */
            attached: function () {
                var panel = this;
                this.$.toolbar.set("commands", []); // TODO: debug why commands are "global"
                this.$.toolbar.addCommand({
                    icon: "fa fa-save",
                    description: "Save graph",
                    shortcut: ["ctrl+s", "meta+s"],
                    action: function () {
                        panel._save();
                    }.bind(this)
                });
                this.$.toolbar.addCommand({
                    icon: "fa fa-play",
                    description: "Build graph",
                    shortcut: ["ctrl+b", "meta+b"],
                    action: function () {
                        panel._build();
                    }.bind(this)
                });
                this.$.toolbar.addCommand({
                    icon: "fa fa-compress",
                    description: "Zoom to fit",
                    shortcut: ["ctrl+0", "meta+0"],
                    action: function () {
                        panel.get("data").get("renderer").zoomToFit();
                    }.bind(this)
                });
                this.fire("dude-inspector-attached");
            },

            /**
             * Called when the panel is opened
             */
            opened: function () {
            },

            /**
             * Called when the panel is the top of the stack
             */
            resumed: function () {
            },

            /**
             * Called when the panel is not anymore the top of the stack
             */
            paused: function () {
            },

            /**
             * Called when the panel is closed
             */
            closed: function () {
            },

            /**
             * Creates the block from the selected model
             * @param {CustomEvent} e
             * @private
             */
            _createBlock: function (e) {
                if (e.detail.item.data) {
                    this.get("data").createBlock(e.detail.item.data);
                }
            },

            /**
             * Saves the graph and renderer
             * @private
             */
            _save: function () {
                this.get("data").emitSave();
            },

            /**
             * Builds the graph and renderer
             * @private
             */
            _build: function () {
                this.get("data").emitBuild();
            }
        });
    </script>
</dom-module>