<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../dude-hierarchy/dude-hierarchy.html">
<link rel="import" href="../../dude-toolbar/dude-toolbar.html">
<link rel="import" href="../../dude-collapse/dude-collapse.html">
<script src="dude-graph-toolbar.js"></script>
<!--
`dude-graph-create` is a panel used to add a new blocks/variables to the graph.

@group dude-graph
@element dude-graph-create-group
@demo demo/index.html
-->
<dom-module id="dude-graph-create">
    <style>
        .toolbar {
            margin-top: 16px;
            margin-bottom: 16px;
        }
    </style>
    <template>
        <div class="toolbar">
            <dude-toolbar id="toolbar"></dude-toolbar>
        </div>
        <dude-collapse heading="Blocks">
            <dude-hierarchy
                    id="modelsHierarchy"
                    placeholder="Search block..."
                    items="{{ models }}"
                    on-dude-hierarchy-item-submit="_createBlock">
            </dude-hierarchy>
        </dude-collapse>
        <dude-collapse heading="Variables">
            <dude-hierarchy
                    id="variablesHierarchy"
                    placeholder="Search variable..."
                    items="{{ variables }}"
                    on-dude-hierarchy-item-submit="_createBlock">
            </dude-hierarchy>
        </dude-collapse>
    </template>
    <script>
        /**
         * @extends {DudeInspectorItemElement}
         */
        Polymer({
            is: "dude-graph-create",
            properties: {
                "inspector": {
                    "type": "DudeInspectorElement",
                    "readonly": true
                },
                "data": {
                    "type": "DudeGraphElement",
                    "readonly": true
                },
                "panelTitle": {
                    "type": String,
                    "value": "Inspector",
                    "readonly": true
                },
                "models": {
                    "computed": "_models(data.graph)"
                },
                "variables": {
                    "computed": "_variables(data.graph)"
                }
            },

            /**
             * Called when the panel is attached to the DOM
             * Notifies the dude-inspector
             */
            attached: function () {
                dudeGraph.ToolbarHelper.clearToolbar(this);
                dudeGraph.ToolbarHelper.saveGraph(this);
                dudeGraph.ToolbarHelper.buildGraph(this);
                dudeGraph.ToolbarHelper.zoomToFit(this);
                dudeGraph.ToolbarHelper.createVariable(this);
                this.fire("dude-inspector-attached");
            },

            /**
             * Called when the panel is opened
             */
            opened: function () {
            },

            /**
             * Called when the panel is the top of the stack
             */
            resumed: function () {
            },

            /**
             * Called when the panel is not anymore the top of the stack
             */
            paused: function () {
            },

            /**
             * Called when the panel is closed
             */
            closed: function () {
            },

            /**
             * Creates the block from the selected model
             * @param {CustomEvent} e
             * @private
             */
            _createBlock: function (e) {
                if (e.detail.item.data) {
                    this.get("data").createBlock(e.detail.item.data);
                }
            },

            /**
             * @returns {Array<dudeGraph.Graph.modelBlockTypedef>}
             * @private
             */
            _models: function () {
                return this.get("data.graph.graphModels") || [];
            },

            /**
             * @returns {Array<dudeGraph.Graph.modelBlockTypedef>}
             * @private
             */
            _variables: function () {
                var variables = this.get("data.graph.graphVariables");
                return _.map(variables, function (variable) {
                    return {
                        "item": {
                            "name": variable.variableName,
                            "icon": "fa fa-circle",
                            "data": {
                                "blockType": "VariableBlock",
                                "blockName": variable.variableName,
                                "blockInputs": [],
                                "blockOutputs": [
                                    {
                                        "pointType": "Point",
                                        "pointValueType": variable.variableValueType,
                                        "pointName": "value"
                                    }
                                ]
                            }
                        }
                    }
                });
            }
        });
    </script>
</dom-module>