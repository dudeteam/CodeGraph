<!doctype html>
<html>
<head>
    <title>CodeGraph</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <script src="../webcomponentsjs/webcomponents.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Varela+Round' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Varela' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Cherry+Cream+Soda' rel='stylesheet' type='text/css'>
    <link rel="import" href="../core-drawer-panel/core-drawer-panel.html">
    <link rel="import" href="../core-header-panel/core-header-panel.html">
    <link rel="import" href="../core-toolbar/core-toolbar.html">
    <link rel="import" href="../core-ajax/core-ajax.html">
    <link rel="import" href="cg-app.html">
    <link rel="stylesheet" href="themes/base.css" shim-shadowdom>
    <link rel="stylesheet" href="themes/audigame/theme.css" shim-shadowdom>
</head>
<body fullbleed unresolved>
    <template id="codegraph-demo" is="auto-binding">
        <core-drawer-panel forceNarrow>
            <core-header-panel main>
                <core-toolbar>
                    <paper-icon-button id="menu-btn" icon="menu" core-drawer-toggle></paper-icon-button>
                    <div id="title" flex><img height="20" src="images/audigame_logo.png"></div>
                    <paper-button class="dark" on-click="{{save}}">Save</paper-button>
                </core-toolbar>
                    <core-ajax id="loader"
                               url="examples/hello_world.json"
                               handleAs="json"
                               on-core-response="{{graphLoaded}}"
                               auto>
                    </core-ajax>
                    <cg-app id="codegraph" logo="images/dude_logo_dark.png"
                            layout horizontal fit>
                    </cg-app>
            </core-header-panel>
            <div drawer>
                <core-menu selected="2">
                    <core-item label="Dashboard" icon="dashboard"></core-item>
                    <core-item label="Shop" icon="shopping-cart"></core-item>
                    <core-item label="Editor" icon="create"></core-item>
                    <core-item label="Get the app!" icon="android"></core-item>
                    <core-item label="Contact" icon="send"></core-item>
                </core-menu>
            </div>
        </core-drawer-panel>
    </template>
    <script src="build-saver.js"></script>
    <script>
        var demo = document.querySelector("#codegraph-demo");
        var jsonSaver = new cg.JSONSaver();
        var buildSaver = new BuildSaver();
        demo.isLoading = true;
        demo.save = function () {
            console.log(this.$.codegraph.save(buildSaver));
//            console.log(JSON.stringify(this.$.codegraph.save(buildSaver), null, 2));
//            console.log(JSON.stringify(this.$.codegraph.save(jsonSaver), null, 2));
        };
        demo.graphLoaded = function () {
            demo.isLoading = false;
            this.$.codegraph.graph = this.$.loader.response;
            this.$.codegraph.addEventListener("ready", function () {
                console.log("Code graph is ready! :)");
            }.bind(this));
            this.$.codegraph.addEventListener("variable.create", function (e) {
                if (this.createVariable(
                        e.detail.variable.data.valueType,
                        e.detail.variable.name,
                        e.detail.variable.data.value
                )) {
                    this.showSuccess("Variable \"" + e.detail.variable.name + "\" successfully created!");
                    this.resetPicker();
                }
            });
            this.$.codegraph.addEventListener("variable.edit", function (e) {
                if (this.editVariable(
                        e.detail.variable.previousName,
                        e.detail.variable.data.valueType,
                        e.detail.variable.name,
                        e.detail.variable.data.value
                )) {
                    this.showSuccess("Variable \"" + e.detail.variable.name + "\" successfully updated!");
                    this.resetPicker();
                }
            });
        };
    </script>
</body>
</html>