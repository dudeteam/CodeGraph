<link rel="import" href="../bower_components/polymer/polymer.html">
<polymer-element name="code-graph">
    <template>
        <style>
            #area {
                background: rgba(0, 0, 0, .8);
                width: 1200px;
                height: 480px;
            }
        </style>
        <div id="area"></div>
    </template>
    <script src="../bower_components/jwerty/jwerty.js"></script>
    <script src="../bower_components/raphael/raphael.js"></script>
    <script src="../scripts/draggable.js"></script>
    <script src="../scripts/connection.js"></script>
    <script src="../scripts/point.js"></script>
    <script src="../scripts/action.js"></script>
    <script src="../scripts/graph.js"></script>
    <script>
        Polymer({
            ready: function() {
                var r = Raphael(this.$.area, 1200, 480);
                var graph = r.graph({
                    "actions": ["blurShader", "bwShader", "mix", "finalOutput"],
                    "connections": [
                        {"from": "blurShader.gl_FragColor", "to": "mix.second"},
                        {"from": "bwShader.gl_FragColor", "to": "mix.first"}
                    ]
                });
                var currentCursor = {x: 0, y: 0};
                window.addEventListener("mousemove", function (e) {
                    currentCursor.x = e.x;
                    currentCursor.y = e.y;
                });
                jwerty.key('⇧+a', function () {
                    var name = window.prompt("Add new action:");
                    if (ACTIONS[name] === undefined) {
                        window.alert("No action named " + name + " registered.");
                    } else {
                        graph.addAction(name, currentCursor.x, currentCursor.y);
                    }
                });
                jwerty.key('⌫/x', function () {
                    if (window.confirm("Are you sure to delete action " + graph.currentAction.name + "?")) {
                        graph.currentAction.destroy();
                    }
                });
            }
        });
    </script>
</polymer-element>