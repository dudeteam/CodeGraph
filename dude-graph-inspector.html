<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">
<link rel="import" href="../dude-collapse/dude-collapse.html">
<link rel="import" href="../dude-hierarchy/dude-hierarchy.html">
<!--
`dude-graph-inspector` is a Polymer element which creates the inspector for a dudeGraphEditor.

@group dude-graph
@element dude-graph-inspector
@demo demo/index.html
-->
<dom-module id="dude-graph-inspector">
    <style>
        :root {
            --default-primary-color: var(--dude-primary-color);
            --text-primary-color: var(--dude-primary-text-color);
            --paper-input-container-focus-color: var(--dude-primary-color);
            --paper-input-container-input-color: var(--dude-content-text-color);
        }

        :host {
            background: var(--dude-secondary-background-color);
            overflow: auto;
            padding: 10px 5px 5px;
        }

        dude-collapse {
            padding-top: 5px;
        }

        #completionHierarchy {
            padding: 10px;
            background: rgba(30, 30, 30, .8);
        }
    </style>
    <template>
        <div class="layout vertical flex">
            <dude-collapse heading="Create">
                <dude-hierarchy
                        items="[[ models ]]"
                        placeholder="Create a block..."
                        on-dude-hierarchy-item-submit="createBlockFromModel">
                </dude-hierarchy>
            </dude-collapse>
        </div>
    </template>
    <script>
        var DudeGraphInspector = Polymer({
            is: "dude-graph-inspector",
            behaviors: [Polymer.IronA11yKeysBehavior],
            properties: {
                /**
                 *
                 */
                "editor": {
                    "type": DudeGraphEditor,
                    "value": null
                },

                /**
                 *
                 */
                "models": {
                    "type": Array,
                    "value": []
                },

                /**
                 *
                 */
                "keyboardShortcuts": {
                    "type": Array,
                    "value": [
                        {"keys": ["ctrl+0", "meta+0"], "action": "zoomToFit"},
                        {"keys": ["ctrl+shift+0", "meta+shift+  0"], "action": "zoomToFit"}
                    ]
                }
            },

            /**
             *
             * @param {DudeGraphEditor} dudeGraphEditor
             */
            start: function (dudeGraphEditor) {
                var inspector = this;
                this.set("editor", dudeGraphEditor);
                this.set("keyEventTarget", document.body);
                this.set("stopKeyboardEventPropagation", true);
                _.forEach(this.get("keyboardShortcuts"), function (keyboardShortcut) {
                    if (navigator.platform.toUpperCase().indexOf("MAC") === -1) { // Windows/Linux
                        inspector.addOwnKeyBinding(keyboardShortcut.keys[0], keyboardShortcut.action);
                    } else { // Mac OSX
                        inspector.addOwnKeyBinding(keyboardShortcut.keys[1] || keyboardShortcut.keys[0], keyboardShortcut.action);
                    }
                });
            },

            /**
             * @param {CustomEvent} e
             */
            zoomToFit:function(e) {
                if (e.detail.shiftKey) {
                    this.get("editor").get("renderer").zoomToFitSelection();
                } else {
                    this.get("editor").get("renderer").zoomToFit();
                }
            },

            /**
             *
             * @param {CustomEvent} e
             */
            createBlockFromModel: function (e) {
                if (e.detail.item.data) {
                    this.editor.createBlock(e.detail.item.data);
                }
            }
        })
    </script>
</dom-module>