<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input-decorator.html">
<link rel="import" href="../paper-dialog/paper-action-dialog.html">
<link rel="import" href="../dude-gui/dude-picker.html">
<link rel="import" href="cg-type-dropdown.html">
<polymer-element name="cg-variable-inspector">
    <template>
        <div>
            <h1>{{_label}}</h1>
            <cg-type-dropdown type="{{_type}}"
                              types="{{types}}"
                              hidden?="{{editMode}}">
            </cg-type-dropdown>
            <paper-input-decorator label="name">
                <input is="core-input" type="text" value="{{_name}}">
            </paper-input-decorator>
            <dude-picker type="{{_type}}" value="{{_value}}"></dude-picker>
            <div layout horizontal class="row" style="margin-bottom: 10px">
                <paper-button on-click="{{_submit}}" flex class="primary">
                    <core-icon icon="check"></core-icon>
                </paper-button>
                <paper-button on-click="{{_close}}" flex class="primary">
                    <core-icon icon="close"></core-icon>
                </paper-button>
            </div>
        </div>
        <paper-action-dialog id="confirm"
                             heading="Are you sure that you want to delete this variable?"
                             transition="core-transition-center" backdrop>
            <paper-button affirmative>No</paper-button>
            <paper-button class="primary" on-click="{{_confirmDelete}}" affirmative autofocus>Yes</paper-button>
        </paper-action-dialog>
    </template>
    <script>
        Polymer({
            publish: {
                editMode: false,
                variable: null,
                types: []
            },
            _name: "",
            _type: "",
            _value: null,
            ready: function () {
                this.editModeChanged();
            },
            typesChanged: function () {
                this._type = this.types[0].name;
                this._name = "";
            },
            editModeChanged: function () {
                if (this.editMode) {
                    this._label = "Edit";
                } else {
                    this._label = "Create";
                }
            },
            variableChanged: function () {
                if (this.variable !== null) {
                    this._name = this.variable.name;
                    this._type = this.variable.data.valueType;
                    this._value = this.variable.data.value;
                } else {
                    this._type = this.types[0].name;
                    this._name = "";
                    this._value = null;
                }
            },
            _valueChanged: function () {
                if (this._type === "sound" && this._value !== null) {
                    this._name = this._value.name;
                }
            },
            _submit: function () {
                var previousName = this.variable !== null ? this.variable.name : null;
                this.variable = {
                    name: this._name,
                    data: new cg.Variable({
                        "name": this._name,
                        "value-type": this._type,
                        "value": this._value
                    })
                };
                if (previousName !== null) {
                    this.variable.previousName = previousName;
                }
                this.fire("submit");
            },
            _close: function () {
                if (this.editMode) {
                    this.$.confirm.open();
                } else {
                    this.fire("cancel");
                }
            },
            _confirmDelete: function () {
                this.fire("delete");
            }
        })
    </script>
</polymer-element>